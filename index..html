<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utah Powder Prophet</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8; --danger: #f43f5e; --success: #10b981; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { text-align: center; color: var(--accent); font-weight: 800; letter-spacing: -1px; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .card { background: var(--card); padding: 24px; border-radius: 16px; border: 1px solid #334155; transition: transform 0.2s; }
        .card:hover { transform: translateY(-4px); border-color: var(--accent); }
        .resort-name { font-size: 1.5rem; margin: 0 0 15px 0; border-bottom: 2px solid #334155; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .stat { display: flex; justify-content: space-between; margin: 12px 0; font-size: 1.1rem; }
        .label { color: #94a3b8; }
        .val { font-weight: 600; }
        .tag { font-size: 0.75rem; padding: 4px 8px; border-radius: 6px; text-transform: uppercase; font-weight: 700; }
        .tag-danger { background: rgba(244, 63, 94, 0.2); color: var(--danger); }
        .tag-success { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        canvas { margin-top: 20px; max-height: 150px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèîÔ∏è Utah Powder Prophet</h1>
        <div id="resort-grid" class="grid">Crunching the data...</div>
    </div>

    <script>
        const resorts = [
            { name: "Alta", lat: 40.5883, lon: -111.6372 },
            { name: "Snowbird", lat: 40.5810, lon: -111.6563 },
            { name: "Brighton", lat: 40.5980, lon: -111.5832 },
            { name: "Solitude", lat: 40.6199, lon: -111.5919 },
            { name: "Deer Valley", lat: 40.6368, lon: -111.4783 }
        ];

        async function fetchWeather(resort) {
            // Using Imperial Units: Fahrenheit, MPH, Inches
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${resort.lat}&longitude=${resort.lon}&hourly=temperature_2m,precipitation,snowfall,wind_speed_10m,wind_gusts_10m&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto&forecast_days=1`;
            const response = await fetch(url);
            return await response.json();
        }

        function getSnowQuality(snowInches, precipInches) {
            if (snowInches < 0.1) return "No Freshies";
            const ratio = snowInches / (precipInches || 0.01);
            if (ratio >= 20) return "Blower (5% density) ‚ùÑÔ∏è";
            if (ratio >= 12) return "Creamy üç¶";
            return "Sierra Cement üß±";
        }

        async function init() {
            const grid = document.getElementById('resort-grid');
            grid.innerHTML = '';

            for (const resort of resorts) {
                const data = await fetchWeather(resort);
                const h = data.hourly;
                
                // Get current hour index
                const now = new Date();
                const currentHour = now.getHours();

                const temp = Math.round(h.temperature_2m[currentHour]);
                const snow = h.snowfall[currentHour];
                const precip = h.precipitation[currentHour];
                const gust = Math.round(h.wind_gusts_10m[currentHour]);
                
                const quality = getSnowQuality(snow, precip);
                const isWindy = gust > 30;

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="resort-name">
                        ${resort.name}
                        <span class="tag ${isWindy ? 'tag-danger' : 'tag-success'}">
                            ${isWindy ? 'Wind Risk' : 'Lifts Spinning'}
                        </span>
                    </div>
                    <div class="stat"><span class="label">Temp</span><span class="val">${temp}¬∞F</span></div>
                    <div class="stat"><span class="label">Snow Quality</span><span class="val">${quality}</span></div>
                    <div class="stat"><span class="label">Wind Gusts</span><span class="val">${gust} mph</span></div>
                    <canvas id="chart-${resort.name.replace(/\s/g, '')}"></canvas>
                `;
                grid.appendChild(card);

                new Chart(document.getElementById(`chart-${resort.name.replace(/\s/g, '')}`), {
                    type: 'line',
                    data: {
                        labels: h.time.slice(currentHour, currentHour + 12).map(t => t.split('T')[1]),
                        datasets: [{
                            label: 'Wind Gusts',
                            data: h.wind_gusts_10m.slice(currentHour, currentHour + 12),
                            borderColor: '#38bdf8',
                            backgroundColor: 'rgba(56, 189, 248, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: { 
                        plugins: { legend: { display: false } },
                        scales: { x: { display: false }, y: { beginAtZero: true, grid: { color: '#334155' } } }
                    }
                });
            }
        }
        init();
    </script>
</body>
</html>